<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DelightMate - Your Intelligent Assistant</title>
    <link href="{{ url_for('static', filename='css/tailwind.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/cosmic.css') }}" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
    </style>
</head>
<body>
    <div class="cosmos-container">
        <!-- Navigation -->
        <div class="cosmic-nav">
            <a href="/" class="nav-item active">Home</a>
            <a href="/email" class="nav-item">Email</a>
            <a href="/calendar" class="nav-item">Calendar</a>
        </div>
        
        <!-- Theme Toggle -->
        <button class="theme-toggle" id="themeToggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="themeIcon">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" class="moon-icon"></path>
                <circle cx="12" cy="12" r="5" class="sun-icon" style="display:none;"></circle>
                <line x1="12" y1="1" x2="12" y2="3" class="sun-icon" style="display:none;"></line>
                <line x1="12" y1="21" x2="12" y2="23" class="sun-icon" style="display:none;"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" class="sun-icon" style="display:none;"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" class="sun-icon" style="display:none;"></line>
                <line x1="1" y1="12" x2="3" y2="12" class="sun-icon" style="display:none;"></line>
                <line x1="21" y1="12" x2="23" y2="12" class="sun-icon" style="display:none;"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" class="sun-icon" style="display:none;"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" class="sun-icon" style="display:none;"></line>
            </svg>
        </button>
        
        <!-- User Profile -->
        {% if user and user.is_logged_in %}
        <div class="cosmic-user-profile">
            {% if user.picture %}
            <img src="{{ user.picture }}" alt="Profile">
            {% else %}
            <div style="width: 40px; height: 40px; border-radius: 50%; background-color: rgba(64, 190, 255, 0.8); display: flex; justify-content: center; align-items: center; color: white; font-weight: bold;">
                {{ user.name[0] if user.name else 'U' }}
            </div>
            {% endif %}
            <span class="cosmic-user-name">{{ user.name if user.name else 'User' }}</span>
        </div>
        {% endif %}
        
        <!-- Voice Mode Indicator -->
        <div class="voice-mode">Voice mode</div>
        
        <!-- Cosmic Sphere -->
        <div class="cosmos-sphere" id="cosmosSphere"></div>
        
        <!-- Status Text -->
        <div class="status-text" id="statusText">Listening...</div>
        
        <!-- Response Container -->
        <div class="cosmic-message-container" id="messageContainer">
            <p class="cosmic-message" id="responseMessage"></p>
        </div>
        
        <!-- Control Buttons -->
        <div class="controls">
            <button class="control-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                </svg>
            </button>
            <button class="control-btn microphone-btn" id="micButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </button>
            <button class="control-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </button>
        </div>

    </div>

    <!-- JavaScript for Cosmic Visualization -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cosmosSphere = document.getElementById('cosmosSphere');
            const statusText = document.getElementById('statusText');
            const micButton = document.getElementById('micButton');
            const messageContainer = document.getElementById('messageContainer');
            const responseMessage = document.getElementById('responseMessage');
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const moonIcon = document.querySelector('.moon-icon');
            const sunIcons = document.querySelectorAll('.sun-icon');
            let isListening = false;
            
            // Initialize theme from localStorage
            initTheme();
            
            // Create cosmic particles
            createCosmicParticles();
            
            // Theme toggle handler
            themeToggle.addEventListener('click', function() {
                toggleTheme();
            });
            
            // Microphone button click handler
            micButton.addEventListener('click', function() {
                if (isListening) {
                    stopListening();
                    
                    // Simulate response
                    simulateResponse("I'm your AI assistant. I can help you manage emails, calendar, and answer questions. What would you like to do today?");
                } else {
                    startListening();
                    
                    // Simulate voice recognition (in a real app, use Web Speech API)
                    setTimeout(() => {
                        stopListening();
                        simulateResponse("I'm your AI assistant. I can help you manage emails, calendar, and answer questions. What would you like to do today?");
                    }, 3000);
                }
            });
            
            // Initialize theme
            function initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'dark';
                document.documentElement.setAttribute('data-theme', savedTheme);
                updateThemeIcon(savedTheme);
            }
            
            // Toggle between light and dark themes
            function toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                updateThemeIcon(newTheme);
            }
            
            // Update theme icon based on current theme
            function updateThemeIcon(theme) {
                if (theme === 'dark') {
                    moonIcon.style.display = 'block';
                    sunIcons.forEach(icon => icon.style.display = 'none');
                } else {
                    moonIcon.style.display = 'none';
                    sunIcons.forEach(icon => icon.style.display = 'block');
                }
            }
            
            // Create cosmic particles in the sphere
            function createCosmicParticles() {
                const colors = ['white', 'blue', 'cyan', 'purple', 'pink'];
                const totalParticles = 200;
                const sphereRadius = 180; // Radius of the cosmic sphere
                
                for (let i = 0; i < totalParticles; i++) {
                    const particle = document.createElement('div');
                    particle.className = `particle ${colors[Math.floor(Math.random() * colors.length)]}`;
                    
                    // Random size between 2-6px
                    const size = Math.random() * 4 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    
                    // Position randomly within the sphere (spherical coordinates)
                    const theta = Math.random() * Math.PI * 2; // Horizontal angle
                    const phi = Math.acos(2 * Math.random() - 1); // Vertical angle
                    const radius = Math.random() * sphereRadius; // Distance from center
                    
                    const x = radius * Math.sin(phi) * Math.cos(theta);
                    const y = radius * Math.sin(phi) * Math.sin(theta);
                    const z = radius * Math.cos(phi);
                    
                    // Calculate opacity based on distance from center (more transparency at edges)
                    const opacity = 0.1 + (1 - (radius / sphereRadius)) * 0.9;
                    
                    // Set animation delay as a CSS variable
                    const delay = Math.random() * 2;
                    particle.style.setProperty('--particle-delay', delay);
                    
                    // Apply styles
                    particle.style.left = `calc(50% + ${x}px)`;
                    particle.style.top = `calc(50% + ${y}px)`;
                    particle.style.opacity = opacity;
                    particle.style.transform = `translateZ(${z}px)`;
                    
                    // Add subtle movement animation
                    const animDuration = 20 + Math.random() * 80;
                    const animDelay = Math.random() * -animDuration;
                    
                    // Use multiple animations for more interesting movement
                    particle.style.animation = `
                        rotate ${animDuration}s linear ${animDelay}s infinite,
                        float ${10 + Math.random() * 10}s ease-in-out ${Math.random() * -10}s infinite
                    `;
                    
                    cosmosSphere.appendChild(particle);
                }
            }
            
            // Start listening animation
            function startListening() {
                isListening = true;
                document.body.classList.add('listening');
                statusText.classList.add('active');
                cosmosSphere.classList.add('pulsate');
                messageContainer.style.display = 'none';
                
                // Make particles bulge with microphone input (simulated)
                const particles = document.querySelectorAll('.particle');
                particles.forEach(particle => {
                    // Add random delay for each particle to create a wave effect
                    const randomDelay = Math.random() * 0.5;
                    particle.style.setProperty('--particle-delay', randomDelay);
                });
            }
            
            // Stop listening animation
            function stopListening() {
                isListening = false;
                document.body.classList.remove('listening');
                statusText.classList.remove('active');
                cosmosSphere.classList.remove('pulsate');
            }
            
            // Simulate AI response
            function simulateResponse(text) {
                // Display the message container
                messageContainer.style.display = 'block';
                
                // Animate text appearing word by word
                const words = text.split(' ');
                responseMessage.textContent = ''; // Clear existing text
                
                let wordIndex = 0;
                const wordInterval = setInterval(() => {
                    if (wordIndex < words.length) {
                        responseMessage.textContent += (wordIndex === 0 ? '' : ' ') + words[wordIndex];
                        wordIndex++;
                    } else {
                        clearInterval(wordInterval);
                    }
                }, 100); // Speed of text appearance
            }
        });
    </script>

    <!-- Footer -->
    <footer class="py-4 text-center text-blue-800 mt-auto">
        <p class="text-sm">&copy; 2025 DelightMate - Your Intelligent Assistant</p>
    </footer>

</body>
</html>